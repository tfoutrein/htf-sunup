---
description:
globs:
alwaysApply: false
---
# HTF Sunup - Domaine MÃ©tier et Logique Applicative

## Vue d'ensemble du Domaine

HTF Sunup est une plateforme de **gamification d'Ã©quipe** permettant de crÃ©er et gÃ©rer des **campagnes de dÃ©fis quotidiens** pour motiver les collaborateurs.

## EntitÃ©s MÃ©tier Principales

### ðŸ‘¥ Acteurs du SystÃ¨me

**Manager** 
- CrÃ©e et gÃ¨re les campagnes
- Supervise plusieurs FBOs
- AccÃ¨de au dashboard de progression d'Ã©quipe

**FBO (Field Business Officer)**
- Participe aux dÃ©fis quotidiens
- Soumet des preuves de rÃ©alisation
- Consulte sa progression personnelle

**Marraine**
- RÃ´le de support et accompagnement
- Dashboard spÃ©cialisÃ© (en dÃ©veloppement)

### ðŸŽ¯ Objets MÃ©tier

**Campaign (Campagne)**
```typescript
// PÃ©riode dÃ©finie avec dÃ©fis quotidiens
{
  name: string;           // "Les dÃ©fis de l'Ã©tÃ© de la Happy Team"
  startDate: Date;        // Date de dÃ©but
  endDate: Date;          // Date de fin
  managerId: number;      // Manager responsable
}
```

**Challenge (DÃ©fi)**
```typescript
// DÃ©fi quotidien dans une campagne
{
  campaignId: number;     // RÃ©fÃ©rence campagne
  name: string;           // "DÃ©fi du 22 juin"
  description: string;    // Description du dÃ©fi
  date: Date;             // Date spÃ©cifique du dÃ©fi
  isActive: boolean;      // ActivÃ©/dÃ©sactivÃ©
}
```

**Action (Action)**
```typescript
// Action spÃ©cifique d'un dÃ©fi
{
  challengeId: number;    // RÃ©fÃ©rence dÃ©fi
  title: string;          // "Partager une photo d'Ã©quipe"
  description: string;    // Description dÃ©taillÃ©e
  points: number;         // Points attribuÃ©s (0-100)
  order: number;          // Ordre d'affichage
}
```

**UserAction (Participation)**
```typescript
// Participation d'un utilisateur Ã  une action
{
  userId: number;         // Participant
  actionId: number;       // Action rÃ©alisÃ©e
  completed: boolean;     // Statut de rÃ©alisation
  proofUrl?: string;      // Preuve uploadÃ©e (optionnel)
  completedAt?: Date;     // Date de rÃ©alisation
}
```

## RÃ¨gles MÃ©tier Principales

### ðŸ“… Gestion Temporelle
1. **Un dÃ©fi par jour** dans une campagne
2. **DÃ©fis activÃ©s automatiquement** selon la date
3. **Actions disponibles uniquement** pour le dÃ©fi du jour actuel
4. **Historique conservÃ©** pour tous les dÃ©fis passÃ©s

### ðŸŽ¯ SystÃ¨me de Points
1. **Chaque action** a un nombre de points (0-100)
2. **Progression calculÃ©e** : actions complÃ©tÃ©es / actions totales
3. **Barres de progression** reprÃ©sentent l'avancement global
4. **Indicateur de jour actuel** sur la timeline

### ðŸ‘¥ Relations HiÃ©rarchiques
1. **Manager supervise plusieurs FBOs**
2. **FBO appartient Ã  un seul manager**
3. **Campagne crÃ©Ã©e par un manager**
4. **Progression visible au niveau Ã©quipe et individuel**

### ðŸ“¸ Gestion des Preuves
1. **Upload optionnel** de preuves (photos/vidÃ©os)
2. **Stockage S3** ou local selon environnement
3. **Formats acceptÃ©s** : jpg, png, gif, mp4, mov
4. **Taille maximale** : 10MB

## Flux Utilisateur Principaux

### Manager - CrÃ©ation de Campagne
1. CrÃ©er une campagne avec dates
2. Ajouter des dÃ©fis quotidiens
3. DÃ©finir 3 actions par dÃ©fi avec points
4. Surveiller la progression de l'Ã©quipe

### FBO - Participation Quotidienne
1. Se connecter au dashboard
2. Voir le dÃ©fi du jour actuel
3. RÃ©aliser les actions
4. Uploader des preuves (optionnel)
5. Marquer les actions comme complÃ©tÃ©es

### Visualisation des DonnÃ©es
1. **Dashboard Manager** : progression Ã©quipe globale
2. **Dashboard FBO** : progression personnelle
3. **Modal dÃ©taillÃ©e** : actions par dÃ©fi avec preuves
4. **Indicateurs visuels** : barres de progression, curseur jour actuel

## Composants UI SpÃ©cialisÃ©s

### Composants MÃ©tier
- [apps/frontend/src/components/campaigns/CampaignCalendar.tsx](mdc:apps/frontend/src/components/campaigns/CampaignCalendar.tsx) - Visualisation calendrier
- [apps/frontend/src/components/campaigns/ActionForm.tsx](mdc:apps/frontend/src/components/campaigns/ActionForm.tsx) - Formulaire d'action
- [apps/frontend/src/components/campaigns/ChallengeForm.tsx](mdc:apps/frontend/src/components/campaigns/ChallengeForm.tsx) - Formulaire de dÃ©fi

### APIs MÃ©tier SpÃ©cialisÃ©es
- `/api/challenges/today/:campaignId` - DÃ©fi du jour
- `/api/actions/team-campaign-progress/:managerId/:campaignId` - Progression Ã©quipe
- `/api/user-actions/:actionId/upload-proof` - Upload preuve

## Ã‰tats et Transitions

### Ã‰tats d'une Action
```
Non commencÃ©e â†’ En cours â†’ ComplÃ©tÃ©e (avec/sans preuve)
```

### Ã‰tats d'un DÃ©fi
```
Ã€ venir â†’ Actif (jour J) â†’ TerminÃ©
```

### Ã‰tats d'une Campagne
```
PlanifiÃ©e â†’ En cours â†’ TerminÃ©e
```

## Calculs MÃ©tier Importants

### Progression Individuelle
```typescript
const progressPercentage = (completedActions / totalActions) * 100;
```

### Progression d'Ã‰quipe
```typescript
const teamProgress = fboProgressions.reduce((sum, fbo) => 
  sum + fbo.progressPercentage, 0) / fboProgressions.length;
```

### Positionnement Jour Actuel
```typescript
const dayPosition = ((currentDay - startDay) / (endDay - startDay)) * 100;
```
